\documentclass[a4j]{ltjsarticle}
\usepackage{url,listings,fancyhdr}
\newcommand{\ir}{ir053\_portable\_x64}
\newcommand{\vboxwin}{VirtualBox-6.0.4-128413-Win.exe}
\newcommand{\vboxmac}{VirtualBox-6.0.4-128413-OSX.dmg}
\newcommand{\vm}{mathlibre2019ja-vm}
\pagestyle{fancy}
\lstset{
  basicstyle=\small\ttfamily,
  keywordstyle=\color{black}\bfseries\underbar,
  stringstyle=\ttfamily,
  showstringspaces=false,
  frameround=tttt,
  frame=trbl
}
\lhead{\Large MathLibre: 仮想環境での利用方法}
\chead{}
\rhead{MathLibre Project}
\begin{document}
%\maketitle
MathLibreはDVDから起動できるLinuxです．しかし，DVDはアクセス速度が遅く
普段使いには不便かもしれません．DVDをISOイメージファイルとしてハードディスクに置
き，仮想化ソフトウェアを用いて仮想環境を作ると，
WindowsやMacを使いながら同時に利用することができます．
以下に紹介する仮想環境 \vm.zip は既に設定済みですので，
継続的なホームディレクトリやパッケージの追加インストールも可能です．
ISOイメージファイルとホームディレクトリのため，約12GB以上の空き領域が必要です．

仮想化ソフトウェアとして，オープンソースソフトウェアの VirtualBox を利用します．
VirtualBoxは既存のオペレーティングシステム上のアプリケーションの一つとし
てインストールされ，この中で追加のオペレーティングシステムを動かすことが
できます．

\section{Windowsの場合}
仮想環境作成に必要なファイルは\underline{DVD内のフォルダvboxにまとめてあります．}\paragraph{VirtualBoxのインストール}
ここではWindows上でMathLibreを動かす方法を解説します．
\begin{enumerate}
 \item %MathLibre DVD内の \vboxwin もしくは
       \url{http://www.virtualbox.org/}から
       Windows用の最新版 VirtualBox を取得し，管理者権限で実行してインストールします．
 \item MathLibre DVD内のファイル \vm.zip をドキュメント等の適当な場所に展開します．展開されたフォルダを \vm とします．
\end{enumerate}

\paragraph{DVDのISOイメージを取得}

ISOイメージの取得方法として「DVDから作成」と「ダウンロード」の2通りの方法があります．
\subparagraph{「DVDから作成」}
ネットワーク環境がない場合でもMathLibre DVDがあれば，ISOイメージを作成できます．
DVDにWindowsアプリケーションInfraRecorderを同梱しています．
InfraRecorderを用いてハードディスク上にMathLibre DVDのISOイメージを作成
します．
\begin{enumerate}
 \item MathLibre DVD内の\ir.zipを適当な場所に展開します．
 \item \ir 内にあるinfrarecorder.exeを実行します．
 \item Read Discを選択します．
 \item Source:としてDVDドライブが選択されているはずです．
 \item Image file:として，先ほどのフォルダ \vm 内にmathlibre.isoを指定します．
 \item OKボタンを押すと，DVDの複製が始まります．
 \item 約4GBのファイルを作成するのに約15分ほどかかります．
\end{enumerate}
\subparagraph{「ダウンロードして取得」}

ネットワーク環境が整っている場合には，
\url{ftp://ftp.mathlibre.org/pub/mathlibre/}より
最新版のISOイメージ（約4GB）をダウンロードできます．
ダウンロードしたら，先ほどのフォルダ \vm 内に移動させて，ファイル名をmathlibre.isoに変更してください．

\paragraph{仮想環境の起動}
すべての作業を終えたら，\vm 内の \vm.vbox をダブルクリックして
VirtualBox を起動してください．起動ボタンを押すと仮想環境が起動します．終了時に，「仮想マシンの状態を保存」すると次回の起動時間を短縮できます．

\section{MacOS Xの場合}
次にMacOS X上でMathLibreを動かす方法を解説します．
最近のMacは標準では光学ドライブを搭載していませんのでネットワークを用いる方法を紹介します．

\paragraph{VirtualBoxのインストール}
\begin{enumerate}
 \item \url{http://www.virtualbox.org/}からMacOS X用の最新版を取得し，実行してインストールします．
 \item \url{ftp://ftp.mathlibre.org/pub/mathlibre/}から \vm.zip をダウンロードし，ホームディレクトリ等の適当な場所に展開します．展開されたディレクトリを \vm とします．
\end{enumerate}

\paragraph{DVDのISOイメージを取得}
\url{ftp://ftp.mathlibre.org/pub/mathlibre}より
最新版のISOイメージファイル（約4GB）をダウンロードしてください．
ダウンロードしたら，先ほどのディレクトリ \vm 内に移動させて，ファイル名をmathlibre.isoに変更してください．

%\subparagraph{DVDから作成}
%ネットワーク環境がない場合でもMathLibre DVDがあれば，ISOイメージを作成で
%きます．MacOS Xのユーティリティの一つ，ディスクユーティリティを用います． 
%\begin{enumerate}
% \item 「Launchpad」の「ユーティリティ」フォルダにある「ディスクユーティリティ」を開きます．
% \item DVD ディスクを光学ドライブにセットし，左側のリストでそのディスクを選択します.
% \item 「ファイル」＞「新規」＞「＜ディスク名＞からのディスクイメージ」と選択します．
% \item ディレクトリ \vm 内に mathlibre.isoというファイル名で作成します．
% \item 「イメージフォーマット」ポップアップメニューからオプションを選択します． 
% \item 「保存」をクリックします．
% \item 約4GBのファイルを作成するのに約15分ほどかかります．
%\end{enumerate}

\paragraph{仮想環境の起動}
\begin{enumerate}
 \item すべての作業を終えたら VirtualBox を起動してください．
 \item メニューから「仮想マシン」＞「追加」で\vm 内の \vm.vbox を選択してください．
 \item 起動ボタンを押すと仮想環境が起動します．
 \item 終了時に「仮想マシンの状態を保存」すると次回の起動時間を短縮できます．
\end{enumerate}

\section{VirtualBoxGuestAdditionsの追加}
仮想環境を起動できれば一応は使えますが，高解像度のデスクトップ利用や，
共有フォルダの作成にはGuestAdditionsと呼ばれる機能の追加が必要です．
まずは，利用しているVirtualBoxのバージョン番号を調べてください．
このバージョン番号をVERSIONとします. 
仮想環境の中でWebブラウザを用いて
\url{http://download.virtualbox.org/virtualbox/} を開くと，
バージョン番号の一覧が表示されます. 適切なバージョン番号を選び，
VBoxGuestAdditions\_VERSION.iso
をダウンロードします. 

このISOイメージに対して，以下の作業を行います. 
\begin{enumerate}
 \item ダウンロードしたVBOXGuestAddtions\_VERSION.isoをマウントする. 
\begin{lstlisting}
sudo mount VBOXGuestAdditions_VERSION.iso /media
\end{lstlisting}
 \item /media内のシェルスクリプト VBOXLinuxAdditinos.run を実行する．
\begin{lstlisting}
sudo sh /media/VBoxLinuxAdditions.run
\end{lstlisting}
\end{enumerate}
数分でGuestAdditionsインストールされます. 
あとは，仮想環境を再起動すれば完成です. 

\section{共有フォルダの作成}
\begin{enumerate}
 \item VirtualBoxの設定アイコンから「共有フォルダー」の\verb|<+>|アイコンをクリックし，「フォルダーのパス」で共有したいフォルダーを指定，表示される「フォルダー名」（この名前は変更可能です．仮に\verb|X|とします．）を控え，「自動マウント」（および，もしあれば「永続化する」）にチェックを入れ，「OK」をクリックしてください．
 \item 仮想マシン上では，\verb|/media/sf_X| にマウントされます（\verb|X|は先に控えたフォルダー名）．この共有フォルダーを仮に\verb|Y|という名前でシンボリックリンク（ショートカットのようなもの）を作成します．端末で以下の命令を入力してください．
\begin{lstlisting}
ln -s /media/sf_X Y
\end{lstlisting}
\item ログアウト後，再ログイン（ユーザ名:user, パスワード live）すれば
\begin{lstlisting}
 ls Y
\end{lstlisting}
のようにアクセスできます．もちろんファイルマネージャPCManFMでも利用可能です．
\end{enumerate}

%\begin{thebibliography}{9}
% \bibitem{diskutil} Disk Utility 12.x: ディスク，CD，または DVD を複製する, \url{http://support.apple.com/kb/PH5846?viewlocale=ja_JP}
%\end{thebibliography}
\end{document}
